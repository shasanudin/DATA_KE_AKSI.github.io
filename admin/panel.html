<h2>Editor Alur DTSEN (Visual)</h2>

<div id="list"></div>

<button onclick="addStep()">+ Tambah Langkah</button>
<button onclick="save()">Simpan ke GitHub</button>

<script>
const OWNER = "USERNAME_GITHUB"
const REPO = "REPO_NAME"
const PATH = "data/alur.json"
const TOKEN = "GITHUB_PAT"

let steps = []

async function load() {
  let res = await fetch(`https://raw.githubusercontent.com/${OWNER}/${REPO}/main/${PATH}`)
  steps = await res.json()
  render()
}

function render() {
  list.innerHTML = ""
  steps.forEach((step, i) => {
    list.innerHTML += `
      <div style="border:1px solid #ccc;padding:10px;margin:10px 0;">
        <input value="${step.title}" placeholder="Judul" 
          oninput="steps[${i}].title=this.value"><br><br>

        <textarea placeholder="Deskripsi"
          oninput="steps[${i}].desc=this.value">${step.desc}</textarea><br><br>

        <button onclick="removeStep(${i})">Hapus</button>
      </div>
    `
  })
}

function addStep() {
  steps.push({ title: "", desc: "" })
  render()
}

function removeStep(i) {
  steps.splice(i, 1)
  render()
}

async function save() {
  let file = await fetch(`https://api.github.com/repos/${OWNER}/${REPO}/contents/${PATH}`)
  let info = await file.json()

  let content = btoa(unescape(encodeURIComponent(JSON.stringify(steps, null, 2))))

  await fetch(`https://api.github.com/repos/${OWNER}/${REPO}/contents/${PATH}`, {
    method: "PUT",
    headers: {
      Authorization: `token ${TOKEN}`
    },
    body: JSON.stringify({
      message: "Update alur.json (visual editor)",
      content,
      sha: info.sha
    })
  })

  alert("Alur tersimpan!")
}

load()
</script>
