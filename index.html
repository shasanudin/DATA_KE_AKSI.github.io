<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Dari Data ke Aksi | TKSK & Puskesos Kec. Sumber</title>
  <meta name="description" content="Dari Data ke Aksi – Pemanfaatan Data DTSEN oleh TKSK Sumber dan Forum Puskesos Kecamatan Sumber">

  <!-- Bootstrap CSS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css">
  <link href="https://fonts.googleapis.com/css?family=Playfair+Display:700,900" rel="stylesheet">
  <link rel="stylesheet" href="css/style.css">
</head>
<body>

<!-- HEADER -->
<header class="container py-3">
  <div class="row align-items-center">
    <div class="col-md-4">
      <img src="assets/img/logo/logo-tksk.png" alt="Logo TKSK" height="55">
      <img src="assets/img/logo/logo-puskesos.png" alt="Logo Puskesos" height="55" class="ml-2">
    </div>
    <div class="col-md-4 text-center">
      <h3 class="mb-0">DARI DATA KE AKSI</h3>
      <small class="text-muted">TKSK & Forum Puskesos Kecamatan Sumber</small>
    </div>
    <div class="col-md-4 text-right">
      <a href="#kontak" class="btn btn-sm btn-outline-secondary">Kontak</a>
    </div>
  </div>
</header>

<!-- NAVBAR -->
<nav class="navbar navbar-expand-lg navbar-light bg-light sticky-top">
  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#mainNav">
    <span class="navbar-toggler-icon"></span>
  </button>
  <div class="collapse navbar-collapse" id="mainNav">
    <ul class="navbar-nav mx-auto">
      <li class="nav-item"><a class="nav-link" href="#data">Data DTSEN</a></li>
      <li class="nav-item"><a class="nav-link" href="#alur">Alur DTSEN</a></li>
      <li class="nav-item"><a class="nav-link" href="#ilmu">Ilmu DTSEN</a></li>
      <li class="nav-item"><a class="nav-link" href="#aplikasi">Aplikasi</a></li>
      <li class="nav-item"><a class="nav-link" href="#wilayah">Wilayah</a></li>
      <li class="nav-item"><a class="nav-link" href="#berita">Berita</a></li>
      <li class="nav-item"><a class="nav-link" href="#struktur">Struktur</a></li>
    </ul>
  </div>
</nav>

<!-- HERO -->
<section class="hero py-5">
  <div class="container">
    <h1>Dari Data ke Aksi</h1>
    <p class="lead">Pemanfaatan Data DTSEN sebagai dasar perencanaan dan aksi kesejahteraan sosial di Kecamatan Sumber.</p>
  </div>
</section>

<!-- DATA DTSEN -->
<section id="data" class="container py-5">
  <h2>Data DTSEN Kecamatan Sumber</h2>
  <p class="text-muted">Ringkasan data kesejahteraan berbasis wilayah.</p>
  <hr>

<h4 class="mt-4">Distribusi DTSEN Seluruh Desa/Kelurahan</h4>
<p class="text-muted">
  Akumulasi jumlah KK per desil (D1–D10) di Kecamatan Sumber.
</p>

<div class="table-responsive">
  <table class="table table-bordered table-sm text-center">
    <thead class="thead-light">
      <tr>
        <th>Desil</th>
        <th>Total KK</th>
      </tr>
    </thead>
    <tbody id="tabelDesilKecamatan">
      <tr>
        <td colspan="2" class="text-muted">Memuat data…</td>
      </tr>
    </tbody>
  </table>
</div>


  <div class="form-group col-md-4 px-0">
    <label><strong>Pilih Desa / Kelurahan</strong></label>
    <select id="wilayahSelect" class="form-control"></select>
  </div>

  <div class="row text-center mb-4">
    <div class="col-md-3">
      <div class="card"><div class="card-body"><h3 id="totalKK">—</h3><p>Total KK</p></div></div>
    </div>
    <div class="col-md-3">
      <div class="card"><div class="card-body"><h3 id="desil12">—%</h3><p>Desil 1–2</p></div></div>
    </div>
    <div class="col-md-3">
      <div class="card"><div class="card-body"><h3 id="desil34">—%</h3><p>Desil 3–4</p></div></div>
    </div>
    <div class="col-md-3">
      <div class="card"><div class="card-body"><h3 id="desil510">—%</h3><p>Desil 5–10</p></div></div>
    </div>
  </div>

  <canvas id="desilChart" height="120"></canvas>

  <small class="text-muted">Pembaruan data: <span id="updateData">-</span></small>
</section>

<!-- PRIORITAS INTERVENSI -->
<section id="prioritas" class="container py-5">
  <h2>Prioritas Intervensi Sosial (Desil 1–2)</h2>
  <p class="text-muted">
    Daftar wilayah berdasarkan jumlah KK Desil 1–2 tertinggi.
  </p>

  <div class="table-responsive">
    <table class="table table-bordered table-sm">
      <thead class="thead-dark">
        <tr>
          <th>Peringkat</th>
          <th>Wilayah</th>
          <th>Jenis</th>
          <th>D1</th>
          <th>D2</th>
          <th>Total</th>
          <th>Status</th>
        </tr>
      </thead>
      <tbody id="tabelPrioritas">
        <tr>
          <td colspan="6" class="text-center text-muted">
            Memuat data…
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</section>


<!-- ALUR DTSEN -->
<section id="alur" class="bg-light py-5">
  <div class="container">
    <h2>Alur DTSEN</h2>
    <ol>
      <li>Pengumpulan data lapangan</li>
      <li>Verifikasi dan validasi</li>
      <li>Penetapan desil kesejahteraan</li>
      <li>Perencanaan program</li>
      <li>Aksi dan monitoring</li>
    </ol>
  </div>
</section>

<!-- ILMU DTSEN -->
<section id="ilmu" class="container py-5">
  <h2>Ilmu DTSEN</h2>
  <p>Desil 1–10 menggambarkan tingkat kesejahteraan rumah tangga. Semakin kecil desil, semakin tinggi prioritas intervensi sosial.</p>
</section>

<!-- APLIKASI -->
<section id="aplikasi" class="bg-light py-5">
  <div class="container">
    <h2>Aplikasi Pendukung</h2>
    <ul>
      <li><strong>SIMPELPAS</strong> – Sistem Pelayanan Sosial</li>
      <li><strong>SIPEPEG</strong> – Sistem Pendataan dan Pengelolaan Pegawai</li>
    </ul>
    <h2>Verifikasi Tanda Tangan Dokumen</h2>
    <textarea id="qrInput" rows="5" placeholder="Tempel isi QR Code di sini"></textarea>
    <button onclick="verify()">Verifikasi</button>
    <div id="result"></div>
  </div>
</section>

<!-- WILAYAH -->
<section id="wilayah" class="container py-5">
  <h2>Desa & Kelurahan Kecamatan Sumber</h2>
  <table class="table table-bordered table-striped">
    <thead class="table-dark"><tr><th>No</th><th>Nama Desa / Kelurahan</th></tr></thead>
    <tbody>
      <tr><td>1</td><td>Babakan</td></tr>
      <tr><td>2</td><td>Gegunung</td></tr>
      <tr><td>3</td><td>Kaliwadas</td></tr>
      <tr><td>4</td><td>Kemantren</td></tr>
      <tr><td>5</td><td>Kenanga</td></tr>
      <tr><td>6</td><td>Pasalakan</td></tr>
      <tr><td>7</td><td>Pejambon</td></tr>
      <tr><td>8</td><td>Perbutulan</td></tr>
      <tr><td>9</td><td>Sendang</td></tr>
      <tr><td>10</td><td>Sumber</td></tr>
      <tr><td>11</td><td>Tukmudal</td></tr>
      <tr><td>12</td><td>Watubelah</td></tr>
      <tr><td>13</td><td>Matangaji</td></tr>
      <tr><td>14</td><td>Sidawangi</td></tr>
    </tbody>
  </table>
</section>

<!-- BERITA -->
<section id="berita" class="container py-5">
  <h2>Berita & Kegiatan</h2>
  <p>Dokumentasi kegiatan TKSK dan Forum Puskesos Kecamatan Sumber.</p>
</section>

<!-- STRUKTUR -->
<section id="struktur" class="bg-light py-5">
  <div class="container">
    <h2>Struktur Organisasi</h2>
    <p>Susunan TKSK dan Forum Puskesos Kecamatan Sumber.</p>
  </div>
</section>

<!-- KONTAK -->
<section id="kontak" class="container py-5">
  <h2>Kontak Kami</h2>
  <p>Email dan alamat resmi.</p>
</section>

<!-- FOOTER -->
<footer class="py-4 text-center">
  <small>© TKSK Sumber & Forum Puskesos Kecamatan Sumber</small>
</footer>

<!-- SCRIPTS -->
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
let chart;
fetch('data/dtsen.json')
  .then(res => res.json())
  .then(data => {
    const select = document.getElementById('wilayahSelect');
    data.wilayah.forEach((w, i) => {
      const opt = document.createElement('option');
      opt.value = i;
      opt.textContent = w.nama;
      select.appendChild(opt);
    });

    document.getElementById('updateData').innerText = data.updated;

    function renderWilayah(idx) {
      const w = data.wilayah[idx];
      document.getElementById('totalKK').innerText = w.total_kk.toLocaleString('id-ID');

      const d12 = w.desil[0] + w.desil[1];
      const d34 = w.desil[2] + w.desil[3];
      const d510 = w.desil.slice(4).reduce((a,b)=>a+b,0);

      document.getElementById('desil12').innerText = d12 + '%';
      document.getElementById('desil34').innerText = d34 + '%';
      document.getElementById('desil510').innerText = d510 + '%';

      const ctx = document.getElementById('desilChart').getContext('2d');
      if (chart) chart.destroy();
      chart = new Chart(ctx, {
        type: 'bar',
        data: {
          labels: ['D1','D2','D3','D4','D5','D6','D7','D8','D9','D10'],
          datasets: [{
            data: w.desil,
            backgroundColor: '#0d6efd'
          }]
        },
        options: {
          plugins: { legend: { display: false } },
          scales: { y: { beginAtZero: true, ticks:{ callback:v=>v+'%' } } }
        }
      });
    }

    select.addEventListener('change', e => renderWilayah(e.target.value));
    renderWilayah(0);
  })
  .catch(err => console.error('Gagal load data DTSEN:', err));
</script>
<script src="js/dtsen.js"></script>
<script>
async function verify() {
  const output = document.getElementById("result");
  output.innerHTML = "Memverifikasi...";

  let data;
  try {
    data = JSON.parse(document.getElementById("qrInput").value);
  } catch {
    output.innerHTML = "❌ Format QR tidak valid";
    return;
  }

  if (data.schema !== "dtsen-signature-v1") {
    output.innerHTML = "❌ Skema tidak dikenali";
    return;
  }

  const enc = new TextEncoder();
  const hashBytes = Uint8Array.from(
    data.hash.match(/.{1,2}/g).map(b => parseInt(b, 16))
  );

  const signature = Uint8Array.from(atob(data.signature), c => c.charCodeAt(0));

  const pem = await fetch("/public-key.pem").then(r => r.text());
  const keyData = pem
    .replace(/-----(BEGIN|END) PUBLIC KEY-----/g, "")
    .replace(/\s+/g, "");

  const binaryKey = Uint8Array.from(atob(keyData), c => c.charCodeAt(0));

  const publicKey = await crypto.subtle.importKey(
    "spki",
    binaryKey,
    { name: "ECDSA", namedCurve: "P-256" },
    false,
    ["verify"]
  );

  const valid = await crypto.subtle.verify(
    { name: "ECDSA", hash: "SHA-256" },
    publicKey,
    signature,
    hashBytes
  );

  output.innerHTML = valid
    ? "✅ DOKUMEN SAH DAN TIDAK DIMODIFIKASI"
    : "❌ TANDA TANGAN TIDAK VALID / DOKUMEN DIUBAH";
}
</script>


</body>
</html>







