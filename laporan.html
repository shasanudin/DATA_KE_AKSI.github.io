<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Laporan Bulanan DTSEN Kecamatan Sumber</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

<style>
body { font-family: "Times New Roman", serif; }
.page { padding: 25mm; page-break-after: always; }
.no-print { margin: 20px; }
header { text-align: center; }
header img { height: 70px; }
h5 { margin-top: 20px; }
canvas { max-width: 100%; height: 300px !important; }
.table-sm td, .table-sm th { font-size: 12px; }
.ttd { height: 100px; }
</style>
</head>

<body>

<div class="no-print">
<button class="btn btn-danger" onclick="exportPDF()">Export PDF</button>
</div>

<div id="laporan">

<!-- ================= COVER ================= -->
<div class="page">
<header>
<img src="assets/img/logo/logo-pemda.png">
<h4 class="font-weight-bold mt-3">LAPORAN BULANAN</h4>
<h4 class="font-weight-bold">DATA TERPADU SOSIAL EKONOMI NASIONAL (DTSEN)</h4>
<p>Kecamatan <span id="kecamatan"></span><br>
Kabupaten <span id="kabupaten"></span><br>
Provinsi Jawa Barat</p>
<p><strong>Periode:</strong> <span id="updated"></span></p>
</header>

<hr>
<p class="text-justify">
Laporan ini disusun sebagai dasar perencanaan, penentuan prioritas,
dan rekomendasi kebijakan pengentasan kemiskinan berbasis Data DTSEN.
</p>
</div>

<!-- ================= GRAFIK DESIL ================= -->
<div class="page">
<h5>Distribusi Rumah Tangga Berdasarkan Kelompok Desil</h5>
<canvas id="chartKelompokDesil"></canvas>
</div>

<!-- ================= GRAFIK PER KELURAHAN ================= -->
<div class="page">
<h5>Grafik Prioritas Desil 1–2 per Kelurahan/Desa</h5>
<canvas id="chartKelurahan"></canvas>
</div>

<!-- ================= TABEL PRIORITAS ================= -->
<div class="page">
<h5>Tabel Prioritas Intervensi dan Tingkat Kerentanan</h5>
<table class="table table-bordered table-sm">
<thead class="thead-light">
<tr>
<th>Wilayah</th>
<th>D1</th>
<th>D2</th>
<th>Total D1–D2</th>
<th>Kerentanan</th>
<th>Prioritas</th>
</tr>
</thead>
<tbody id="tabelPrioritas"></tbody>
</table>
</div>

<!-- ================= REKOMENDASI ================= -->
<div class="page">
<h5>Rekomendasi Pengentasan Kemiskinan Kecamatan Sumber</h5>
<ol>
<li>Penguatan bantuan sosial adaptif untuk KK Desil 1–2.</li>
<li>Program padat karya berbasis kelurahan prioritas.</li>
<li>Optimalisasi Puskesos sebagai layanan satu pintu.</li>
<li>Pendampingan kewirausahaan mikro untuk Desil 3–4.</li>
<li>Validasi dan pemutakhiran data DTSEN berkala.</li>
</ol>
</div>

<!-- ================= RAB ================= -->
<div class="page">
<h5>Rencana Anggaran Biaya (RAB) Prioritas Tinggi D1–D2</h5>
<table class="table table-bordered table-sm">
<thead class="thead-light">
<tr>
<th>No</th>
<th>Uraian</th>
<th>Volume</th>
<th>Satuan</th>
<th>Harga (Rp)</th>
<th>Jumlah (Rp)</th>
</tr>
</thead>
<tbody>
<tr><td>1</td><td>Bantuan Sosial Tunai</td><td>1.000</td><td>KK</td><td>500.000</td><td>500.000.000</td></tr>
<tr><td>2</td><td>Padat Karya</td><td>10</td><td>Paket</td><td>50.000.000</td><td>500.000.000</td></tr>
<tr><td>3</td><td>Pendampingan Sosial</td><td>12</td><td>Bulan</td><td>10.000.000</td><td>120.000.000</td></tr>
<tr class="font-weight-bold">
<td colspan="5" class="text-right">TOTAL</td>
<td>1.120.000.000</td>
</tr>
</tbody>
</table>
</div>

<!-- ================= TTD ================= -->
<div class="page">
<div class="row text-center mt-5">
<div class="col-6">
<p>Mengetahui,<br>Camat Sumber</p>
<div class="ttd"></div>
<p><strong>(............................)</strong><br>
NIP. ............................</p>
</div>

<div class="col-6">
<p id="tanggalTTD"></p>
<p>TKSK Kecamatan Sumber</p>
<div id="qrcode"></div>
<p><strong>Shidiq Hasanudin, S.IP</strong></p>
</div>
</div>
</div>

</div>

<script>
fetch("data/dtsen.json").then(r=>r.json()).then(data=>{

document.getElementById("kecamatan").innerText = data.kecamatan;
document.getElementById("kabupaten").innerText = data.kabupaten;
document.getElementById("updated").innerText = data.updated;

const total = [0,0,0,0,0,0];
const labelsKel = [];
const dataKel = [];

data.wilayah.forEach(w=>{
 total[0]+=w.desil[0];
 total[1]+=w.desil[1];
 total[2]+=w.desil[2];
 total[3]+=w.desil[3];
 total[4]+=w.desil[4];
 total[5]+=w.desil.slice(5).reduce((a,b)=>a+b,0);

 const d12 = w.desil[0]+w.desil[1];
 labelsKel.push(w.nama);
 dataKel.push(d12);

 let prioritas = d12>=400?"Tinggi":d12>=200?"Sedang":"Rendah";
 let kerentanan = d12>=400?"Sangat Rentan":d12>=200?"Rentan":"Relatif Stabil";

 document.getElementById("tabelPrioritas").innerHTML += `
 <tr>
 <td>${w.nama}</td>
 <td>${w.desil[0]}</td>
 <td>${w.desil[1]}</td>
 <td><strong>${d12}</strong></td>
 <td>${kerentanan}</td>
 <td>${prioritas}</td>
 </tr>`;
});

// Grafik Kelompok
new Chart(chartKelompokDesil,{
 type:"bar",
 data:{
 labels:["D1","D2","D3","D4","D5","D6–D10"],
 datasets:[{data:total,backgroundColor:"#007bff"}]
 },
 options:{plugins:{legend:{display:false}}}
});

// Grafik Kelurahan
new Chart(chartKelurahan,{
 type:"bar",
 data:{
 labels:labelsKel,
 datasets:[{data:dataKel,backgroundColor:"#dc3545"}]
 },
 options:{
 indexAxis:"y",
 plugins:{legend:{display:false}}
 }
});

// QR E-Sign
new QRCode(document.getElementById("qrcode"),{
 text: JSON.stringify({
 dokumen:"Laporan DTSEN",
 periode:data.updated,
 penandatangan:"Shidiq Hasanudin, S.IP",
 waktu:new Date().toISOString()
 }),
 width:120,height:120
});

document.getElementById("tanggalTTD").innerText =
"Sumber, "+new Date().toLocaleDateString("id-ID",
{day:"numeric",month:"long",year:"numeric"});

});

function exportPDF(){
 html2pdf().set({
 margin:10,
 filename:"Laporan_DTSEN_Sumber.pdf",
 jsPDF:{format:"a4"}
 }).from(document.getElementById("laporan")).save();
}
</script>

</body>
</html>
