<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Dari Data ke Aksi | TKSK & Puskesos Kec. Sumber</title>
  <meta name="description" content="Dari Data ke Aksi – Pemanfaatan Data DTSEN oleh TKSK Sumber dan Forum Puskesos Kecamatan Sumber">

  <!-- Bootstrap CSS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css">
  <link href="https://fonts.googleapis.com/css?family=Playfair+Display:700,900" rel="stylesheet">
  <link rel="stylesheet" href="css/style.css">
</head>
<body>

<header class="container py-3">
  <div class="row align-items-center">
    <div class="col-md-4">
      <img src="assets/img/logo/logo-tksk.png" alt="Logo TKSK" height="55">
      <img src="assets/img/logo/logo-puskesos.png" alt="Logo Puskesos" height="55" class="ml-2">
    </div>
    <div class="col-md-4 text-center">
      <h3 class="mb-0">DARI DATA KE AKSI</h3>
      <small class="text-muted">TKSK & Forum Puskesos Kecamatan Sumber</small>
    </div>
    <div class="col-md-4 text-right">
      <a href="#kontak" class="btn btn-sm btn-outline-secondary">Kontak</a>
    </div>
  </div>
</header>


<div id="navbar"></div>

  <!-- PRIORITAS INTERVENSI -->
  <div class="text-center mb-4 d-none d-print-block">
  <h3>LAPORAN PRIORITAS INTERVENSI SOSIAL</h3>
  <p>
    Kecamatan Sumber, Kabupaten Cirebon<br>
    Sumber Data: DTSEN<br>
    Update: <span id="updateData"></span>
  </p>
</div>

<main id="prioritas" class="container py-5">
  <h2>Prioritas Intervensi Sosial (Desil 1–2)</h2>
  <p class="text-muted">
    Daftar wilayah berdasarkan jumlah KK Desil 1–2 tertinggi.
  </p>

  <div class="table-responsive">
    <table class="table table-bordered table-sm">
      <thead class="thead-dark">
        <tr>
          <th>Peringkat</th>
          <th>Wilayah</th>
          <th>Jenis</th>
          <th>D1</th>
          <th>D2</th>
          <th>Total</th>
          <th>Status</th>
        </tr>
      </thead>
      <tbody id="tabelPrioritas">
        <tr>
          <td colspan="6" class="text-center text-muted">
            Memuat data…
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</main>

<footer class="py-4 text-center">
  <small>© TKSK Sumber & Forum Puskesos Kecamatan Sumber</small>
</footer>

<script>
fetch('navbar.html')
  .then(r => r.text())
  .then(html => {
    document.getElementById('navbar').innerHTML = html;

    const page = location.pathname.split('/').pop() || 'index.html';
    document.querySelectorAll('.nav-link').forEach(a => {
      if (a.getAttribute('href') === page) {
        a.classList.add('active');
      }
    });
  });
</script>
<!-- SCRIPTS -->
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
let chart;
fetch('data/dtsen.json')
  .then(res => res.json())
  .then(data => {
    const select = document.getElementById('wilayahSelect');
    data.wilayah.forEach((w, i) => {
      const opt = document.createElement('option');
      opt.value = i;
      opt.textContent = w.nama;
      select.appendChild(opt);
    });

    document.getElementById('updateData').innerText = data.updated;

    function renderWilayah(idx) {
      const w = data.wilayah[idx];
      document.getElementById('totalKK').innerText = w.total_kk.toLocaleString('id-ID');

      const d12 = w.desil[0] + w.desil[1];
      const d34 = w.desil[2] + w.desil[3];
      const d510 = w.desil.slice(4).reduce((a,b)=>a+b,0);

      document.getElementById('desil12').innerText = d12 + '%';
      document.getElementById('desil34').innerText = d34 + '%';
      document.getElementById('desil510').innerText = d510 + '%';

      const ctx = document.getElementById('desilChart').getContext('2d');
      if (chart) chart.destroy();
      chart = new Chart(ctx, {
        type: 'bar',
        data: {
          labels: ['D1','D2','D3','D4','D5','D6','D7','D8','D9','D10'],
          datasets: [{
            data: w.desil,
            backgroundColor: '#0d6efd'
          }]
        },
        options: {
          plugins: { legend: { display: false } },
          scales: { y: { beginAtZero: true, ticks:{ callback:v=>v+'%' } } }
        }
      });
    }

    select.addEventListener('change', e => renderWilayah(e.target.value));
    renderWilayah(0);
  })
  .catch(err => console.error('Gagal load data DTSEN:', err));
</script>
<script src="js/dtsen.js"></script>
